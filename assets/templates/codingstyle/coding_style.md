# 编程风格

## 不可变性 (核心 - CRITICAL)

始终创建新对象，严禁修改现有对象：

```c
// 伪代码示例
错误：modify(original, field, value) → 原地修改原始对象
正确：update(original, field, value) → 返回包含更改的新副本
```

**原理：** 不可变数据可以防止隐藏的侧重效应（Side Effects），使调试更容易，并能实现安全的并发。

## 文件组织

**多小文件 > 少大文件：**
- 高内聚，低耦合。
- 典型行数为 200-400 行，上限为 800 行。
- 从大型模块中提取工具函数（Utilities）。
- 按功能/领域组织文件，而不是按类型。

## 错误处理

始终全面地处理错误：
- 在每一个层级显式地处理错误。
- 在面向 UI 的代码中提供用户友好的错误消息。
- 在服务器端记录详细的错误上下文日志。
- 严禁静默处理（吞掉）错误。

## 输入校验

始终在系统边界进行校验：
- 在处理之前校验所有用户输入。
- 尽可能使用基于 Schema（模式）的校验。
- 快速失败（Fail fast）并提供清晰的错误消息。
- 永远不要信任外部数据（API 响应、用户输入、文件内容）。

## 代码质量检查清单

在标记任务完成之前：
- [ ] 代码可读且命名规范
- [ ] 函数短小（<50 行）
- [ ] 文件专注（<800 行）
- [ ] 无深层嵌套（>4 层）
- [ ] 完善的错误处理
- [ ] 无硬编码值（使用常量或配置）
- [ ] 无突变/修改（使用不可变模式）
